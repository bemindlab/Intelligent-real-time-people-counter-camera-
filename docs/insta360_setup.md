# การตั้งค่า Insta360 Go 3S กับระบบ MANTA

คู่มือนี้จะแนะนำวิธีการเชื่อมต่อกล้อง Insta360 Go 3S กับระบบ MANTA ผ่านโปรโตคอล WebCam ผ่าน WiFi

## ความต้องการเบื้องต้น

- กล้อง Insta360 Go 3S
- Raspberry Pi 4 หรือ 5 ที่ติดตั้งระบบ MANTA
- การเชื่อมต่อ WiFi
- OpenCV ที่คอมไพล์พร้อมการรองรับ RTMP (ติดตั้งโดยอัตโนมัติในการติดตั้ง MANTA)

## ขั้นตอนการตั้งค่า

### 1. การตั้งค่ากล้อง Insta360 Go 3S

1. **เปิดกล้อง Insta360 Go 3S**:
   - กดปุ่มเปิดเครื่องบนกล้องค้างไว้จนกระทั่งไฟเปิด

2. **เข้าสู่โหมด WiFi**:
   - เข้าสู่เมนูการตั้งค่าของกล้อง
   - เปิดใช้งาน WiFi
   - จดบันทึกชื่อ SSID และรหัสผ่าน (โดยปกติจะเป็น "Insta360GO3S_XXXX" และรหัสผ่านเริ่มต้นคือ "Insta!360")

3. **เปิดใช้งานการสตรีม RTMP**:
   - ในแอป Insta360 บนสมาร์ทโฟน เชื่อมต่อกับกล้องและเปิดใช้งานการสตรีม RTMP
   - ตั้งค่า URL เป็น `rtmp://192.168.42.1:1935/live/stream` (นี่คือ URL เริ่มต้น)
   - เปิดใช้งานการสตรีมและตรวจสอบว่ากล้องแสดงสถานะสตรีมอยู่

### 2. การตั้งค่า MANTA สำหรับ Insta360

1. **คัดลอกไฟล์การกำหนดค่าสำหรับ WebCam**:
   ```bash
   sudo cp /etc/manta-camera/config.webcam.yaml /etc/manta-camera/config.yaml
   ```

2. **แก้ไขไฟล์การกำหนดค่า**:
   ```bash
   sudo nano /etc/manta-camera/config.yaml
   ```

3. **ปรับแต่งการตั้งค่า WiFi และอุปกรณ์**:
   - แก้ไข `camera_ssid` เป็นชื่อ SSID ของกล้องของคุณ (ตัวอย่าง: "Insta360GO3S_AB12")
   - แก้ไข `camera_password` เป็นรหัสผ่าน WiFi ของกล้อง
   - ตรวจสอบให้แน่ใจว่า URL ในการกำหนดค่า `source` ถูกต้อง (โดยปกติคือ `rtmp://192.168.42.1:1935/live/stream`)

4. **บันทึกไฟล์และออกจากตัวแก้ไข**:
   - กด `Ctrl+O` เพื่อบันทึก
   - กด `Ctrl+X` เพื่อออก

## การรันระบบกับ Insta360

### การรันโดยใช้บริการ systemd

หลังจากการกำหนดค่า คุณสามารถรีสตาร์ทบริการ MANTA:

```bash
sudo systemctl restart manta-camera
```

เพื่อตรวจสอบสถานะ:

```bash
sudo systemctl status manta-camera
```

### การรันจากบรรทัดคำสั่ง

คุณยังสามารถรันระบบโดยตรงจากบรรทัดคำสั่งในโหมดดีบั๊ก:

```bash
sudo python3 /usr/share/manta-camera/camera/main.py --webcam-mode --debug
```

หรือกำหนด URL เฉพาะที่:

```bash
sudo python3 /usr/share/manta-camera/camera/main.py --webcam-mode --device-url "rtmp://192.168.42.1:1935/live/stream" --debug
```

## การแก้ไขปัญหา

### ปัญหาการเชื่อมต่อ WiFi

1. **ไม่สามารถเชื่อมต่อกับ WiFi ของกล้อง**:
   - ตรวจสอบว่ากล้องเปิดอยู่และโหมด WiFi ทำงาน
   - ตรวจสอบให้แน่ใจว่า SSID และรหัสผ่านถูกต้อง
   - รีสตาร์ทกล้องและลองอีกครั้ง

2. **การเชื่อมต่อ WiFi ไม่เสถียร**:
   - เคลื่อนย้ายกล้องและ Raspberry Pi ให้ใกล้กันมากขึ้น
   - ตรวจสอบระดับแบตเตอรี่ของกล้อง

### ปัญหาการสตรีม RTMP

1. **ไม่สามารถเข้าถึงสตรีม**:
   - ตรวจสอบว่าการสตรีม RTMP เปิดใช้งานในกล้อง
   - ตรวจสอบว่า IP และพอร์ตถูกต้อง (โดยปกติคือ 192.168.42.1:1935)
   - ลองเช็คการเชื่อมต่อด้วย VLC หรือเครื่องมืออื่น

2. **คุณภาพวิดีโอไม่ดี**:
   - ปรับความละเอียดให้ต่ำลงในการกำหนดค่า
   - เพิ่มค่า frame_skip เพื่อลดภาระการประมวลผล

### ปัญหาการตรวจจับ

1. **ไม่พบการตรวจจับ**:
   - ตรวจสอบว่ากล้องไม่ได้อยู่ในโหมดขาวดำหรือโหมดพิเศษอื่นๆ
   - ตรวจสอบให้แน่ใจว่ามีแสงเพียงพอสำหรับการตรวจจับ

2. **การตรวจจับช้า**:
   - ลดความละเอียดของการสตรีม
   - เพิ่มการข้ามเฟรมในการกำหนดค่า
   - ใช้โมเดลที่เล็กลง (เช่น yolov8n)

## การปรับแต่งประสิทธิภาพ

### การปรับแต่งกล้อง Insta360

1. **ความละเอียด**:
   - สำหรับ Raspberry Pi 4: ใช้ความละเอียด 720p
   - สำหรับ Raspberry Pi 5: ใช้ความละเอียด 1080p

2. **อัตราเฟรม**:
   - ใช้ 15-20 FPS สำหรับประสิทธิภาพที่ดีขึ้น

### การปรับแต่ง MANTA

1. **การปรับแต่งการตรวจจับ**:
   - เพิ่มค่า frame_skip เป็น 2-3 เพื่อประมวลผลเฟรมน้อยลง
   - ลดขนาดโมเดลเป็น yolov8n สำหรับประสิทธิภาพที่ดีขึ้น

2. **การปรับแต่งระบบ**:
   - เพิ่มค่า memory_limit หากมีหน่วยความจำเพียงพอ
   - ปรับค่า cpu_threads ให้เหมาะสมกับฮาร์ดแวร์ของคุณ

## เคล็ดลับเพิ่มเติม

1. **การใช้พลังงาน**:
   - กล้อง Insta360 Go 3S มีแบตเตอรี่ที่จำกัด พิจารณาการใช้แหล่งจ่ายไฟภายนอกสำหรับการใช้งานระยะยาว
   - เชื่อมต่อกล้องกับแหล่งจ่ายไฟผ่าน USB-C เมื่อใช้งานเป็นเวลานาน

2. **มุมมองกล้อง**:
   - ติดตั้งกล้องในตำแหน่งที่มองเห็นพื้นที่ได้ดีที่สุด
   - หลีกเลี่ยงแสงสว่างจ้าโดยตรงเพื่อป้องกันการสะท้อนและแสงจ้า

3. **การบำรุงรักษา**:
   - ตรวจสอบให้แน่ใจว่ากล้องไม่ร้อนเกินไประหว่างการใช้งานนาน
   - ทำความสะอาดเลนส์เป็นประจำเพื่อคุณภาพภาพที่ดีที่สุด

## ตำแหน่งไฟล์สำคัญ

- ไฟล์การกำหนดค่า: `/etc/manta-camera/config.yaml`
- ไฟล์บันทึก: `/var/log/manta-camera/manta.log`
- ไฟล์กิจกรรม: `/var/log/manta-camera/events.json`
- อรรถประโยชน์ WebCam: `/usr/share/manta-camera/utils/webcam_utils.py`