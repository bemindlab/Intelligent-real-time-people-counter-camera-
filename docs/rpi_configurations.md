# การกำหนดค่า MANTA สำหรับ Raspberry Pi

เอกสารนี้อธิบายการกำหนดค่าที่เหมาะสมสำหรับการรัน MANTA บน Raspberry Pi ทั้งรุ่น 4 และ 5

## ตารางเปรียบเทียบประสิทธิภาพ

| พารามิเตอร์ | Raspberry Pi 4 | Raspberry Pi 5 | หมายเหตุ |
|------------|----------------|----------------|----------|
| ความละเอียด | 640x480 | 1280x720 | Pi 5 มีประสิทธิภาพดีกว่าสำหรับความละเอียดสูง |
| FPS | 10 | 20 | Pi 5 สามารถจัดการกับอัตราเฟรมที่สูงขึ้นได้ |
| โมเดล | YOLOv8n | YOLOv8s | Pi 5 สามารถใช้โมเดลที่ใหญ่กว่าได้ |
| การข้ามเฟรม | 2 | 0 | Pi 4 ต้องข้ามเฟรมเพื่อประสิทธิภาพที่ดีขึ้น |
| คุณลักษณะขั้นสูง | ไม่รองรับ | รองรับ | Pi 5 รองรับการติดตามและการวิเคราะห์ขั้นสูง |

## การติดตั้ง

สคริปต์ `rpi_setup.sh` จะตั้งค่า MANTA บน Raspberry Pi โดยอัตโนมัติ:

```bash
./scripts/rpi_setup.sh
```

สคริปต์นี้จะตรวจจับรุ่นของ Raspberry Pi และใช้การกำหนดค่าที่เหมาะสม

## การกำหนดค่าสำหรับ Raspberry Pi 4

ไฟล์ `config.rpi4.yaml` มีการปรับแต่งพิเศษสำหรับข้อจำกัดของ Raspberry Pi 4:

### ข้อควรพิจารณาสำหรับ Raspberry Pi 4

1. **การประหยัดทรัพยากร**:
   - ลดความละเอียดเป็น 640x480
   - ลด FPS เป็น 10
   - ข้ามเฟรมในการตรวจจับ (ประมวลผลทุกเฟรมที่ 3 เท่านั้น)
   - ปิดการแสดงผลวิดีโอเพื่อประหยัด CPU

2. **การปรับแต่งโมเดล**:
   - ใช้โมเดล YOLOv8n ที่เล็กที่สุด
   - ลดขนาดเวกเตอร์คุณลักษณะเป็น 64
   - ลดระยะเวลาการจดจำบุคคลเป็น 30 นาที

3. **การจัดการข้อมูล**:
   - เพิ่มขนาดชุดอัปโหลดเพื่อลดการส่งข้อมูล
   - อัปโหลดข้อมูลถี่น้อยลง (ทุก 5 นาที)
   - เก็บบันทึกเพียง 3 วัน

### คำแนะนำเพิ่มเติมสำหรับ Raspberry Pi 4

- ใช้ Raspberry Pi 4 ที่มี RAM 4GB หรือมากกว่า
- ติดตั้งตัวระบายความร้อนที่เพียงพอ
- ใช้แหล่งจ่ายไฟที่มีกำลังเพียงพอ (แนะนำ 3A+)
- หากระบบยังช้า ลองปรับลดความละเอียดเป็น 480x360

## การกำหนดค่าสำหรับ Raspberry Pi 5

ไฟล์ `config.rpi5.yaml` ใช้ประโยชน์จากประสิทธิภาพที่ดีขึ้นของ Raspberry Pi 5:

### คุณสมบัติสำหรับ Raspberry Pi 5

1. **ประสิทธิภาพที่ดีขึ้น**:
   - รองรับความละเอียด 1280x720
   - เพิ่ม FPS เป็น 20
   - ประมวลผลทุกเฟรม (ไม่มีการข้ามเฟรม)
   - สามารถแสดงผลวิดีโอโดยไม่กระทบประสิทธิภาพมาก

2. **โมเดลที่ซับซ้อนขึ้น**:
   - รองรับโมเดล YOLOv8s ที่ใหญ่ขึ้น
   - ใช้เวกเตอร์คุณลักษณะขนาดเต็ม 128
   - รองรับการจดจำบุคคลเป็นเวลา 1 ชั่วโมง

3. **คุณสมบัติขั้นสูง**:
   - การติดตามการเคลื่อนไหวขั้นสูง
   - การตรวจจับการเข้าโซน
   - การนับจำนวนคน
   - การสร้างแผนที่ความร้อนการเคลื่อนไหว

### การเร่งความเร็วด้วยฮาร์ดแวร์บน Pi 5

Raspberry Pi 5 มี NPU (Neural Processing Unit) ที่สามารถใช้เพื่อเร่งความเร็วการประมวลผลของโมเดล YOLO:

```yaml
detection:
  device: "NPU"  # ใช้ NPU ของ Raspberry Pi 5
```

หากการใช้งาน NPU ยังไม่รองรับหรือมีปัญหา คุณสามารถกลับไปใช้ CPU ได้:

```yaml
detection:
  device: "CPU"
```

## การปรับแต่งเพิ่มเติม

คุณสามารถปรับแต่งค่าพารามิเตอร์ต่อไปนี้ตามความเหมาะสมของการใช้งาน:

### การปรับแต่งการใช้ทรัพยากร

```yaml
system:
  memory_limit: 75  # จำกัดการใช้หน่วยความจำ (%)
  cpu_threads: 3    # จำกัดจำนวนเธรด CPU (ใช้ 0 สำหรับการตั้งค่าอัตโนมัติ)
```

### การปรับแต่งการตรวจจับ

```yaml
detection:
  confidence_threshold: 0.45  # ลดค่านี้เพื่อตรวจจับมากขึ้น เพิ่มค่านี้เพื่อความแม่นยำ
  nms_threshold: 0.5         # ค่า Non-maximum suppression
```

### การปรับแต่งการซิงโครไนซ์

```yaml
firebase:
  upload_interval: 300  # ระยะเวลา (วินาที) ระหว่างการอัปโหลดข้อมูล
  batch_size: 20        # จำนวนรายการต่อการอัปโหลดหนึ่งครั้ง
```

## การแก้ไขปัญหา

### ระบบช้า

1. ตรวจสอบอุณหภูมิของ Raspberry Pi:
   ```bash
   vcgencmd measure_temp
   ```

2. ตรวจสอบการใช้ทรัพยากร:
   ```bash
   top
   ```

3. ลองปรับลดพารามิเตอร์:
   - ลดความละเอียด
   - เพิ่มการข้ามเฟรม
   - ลดขนาดโมเดล
   - ปิดคุณสมบัติขั้นสูง

### การตรวจจับไม่แม่นยำ

1. ปรับ confidence_threshold:
   - ลดค่าเพื่อตรวจจับมากขึ้น
   - เพิ่มค่าเพื่อลดการตรวจจับผิด

2. ปรับปรุงแสงสว่าง:
   - ตรวจสอบว่ามีแสงเพียงพอในพื้นที่ที่ตรวจจับ

3. ปรับตำแหน่งกล้อง:
   - ตรวจสอบว่ากล้องได้รับมุมมองที่ชัดเจนของพื้นที่ที่สนใจ